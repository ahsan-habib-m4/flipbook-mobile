!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var e,n,o,i,r,a,f,s,u,c,d,l,h,p,m,g,w,v,x,b={},M=-1,y=function(){window.requestAnimatoinFrame=K();var t=A();t?P("invalid options, missing "+t):(F(),k(),q(),H(function(t){t?P(t):I()}))},A=function(){var e,n;return n=t.sprite?["id","path","extension","filename","rows"]:["id","path","extension","filename","count"],n.forEach(function(n){t[n]||(e=n)}),e},F=function(){t.speed=isNaN(t.speed)?.5:Math.min(Math.max(0,parseFloat(t.speed)),1),t.sprite?t.count=t.rows.reduce(function(t,e){return t+e}):t.count=parseInt(t.count),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/"),x=t.gif},I=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),w=!0,N(),E(),j(0),x&&B()},k=function(){e=document.getElementById(t.id),e.classList.add("flipbook-container"),n=document.createElement("div"),n.classList.add("flipbook-graphic"),e.appendChild(n),o=z(n),i=o.getContext("2d")},q=function(){D(e,{position:"relative",width:"100%",overflow:"hidden"}),D(n,{position:"absolute",top:0,left:0}),D(o,{position:"absolute",top:0,left:0})},E=function(){window.addEventListener("resize",N,!1),x||window.addEventListener("scroll",T,!1)},H=function(e){var n=t.sprite?t.rows.length:n=t.count;m=Y(n),g=[],L(0,n,e)},L=function(t,e,n){var o=m[t];J(o,function(i,r){if(i)n("error loading image");else{o.img=r,0===t&&R(r,o.rows);for(var a=0;a<o.rows;a++)g.push({imageIndex:t,x:0,y:a});C(t,e),t++,t<m.length?L(t,e,n):n()}})},R=function(t,e){l=t.naturalWidth,h=t.naturalHeight/e,p=Math.round(l/h*1e3)/1e3},C=function(e,n){t.progress&&"function"==typeof t.progress&&t.progress({frame:e+1,total:t.count,percent:Math.round(e/(n-1)*100)})},Y=function(e){for(var n=[],o=0;o<e;o++){var i=X(o+1);n[o]={src:i,rows:t.sprite?t.rows[o]:1}}return n},X=function(e){for(var n=t.filename.match(/\%\dd/),o=n[0].charAt(1),i=e.toString().length,r=Math.max(o-i,0),a=t.filename.split(/\%\dd/)[0],f=t.path+a,s=0;s<r;s++)f+="0";return f+=e+"."+t.extension},z=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},B=function(){var t=g.length,e=0,n=function(){j(e),e++,e>=t&&(e=0),setTimeout(n,60)};n()},N=function(){if(r=e.offsetWidth,t.cover&&!x){a=innerHeight;var i=r/a;i<p?(b.width=Math.floor(i*h),b.height=h,b.offsetX=Math.floor((l-b.width)/2),b.offsetY=0):(b.height=Math.floor(l/i),b.width=l,b.offsetX=0,b.offsetY=Math.floor((h-b.height)/2))}else a=Math.floor(r/p);var u;u=x?20:innerHeight-a,s=a+u,o.width=r,o.height=a,o.style.top=Math.floor(u/2)+"px",n.style.height=s+"px",n.style.width=r+"px";var d=G();f=x?s:innerHeight*d,e.style.height=f+"px",O(),!x&&c&&(W(),S(pageYOffset-c,!0))},O=function(){var t=e.getBoundingClientRect();u=t.left,c=t.top,d=t.bottom-n.offsetHeight},T=function(){v||requestAnimationFrame(W),v=!0},W=function(){v=!1,w&&(O(),c<0&&d>0?(D(n,{position:"fixed",top:0,left:u+"px",bottom:"auto"}),S(Math.abs(c))):d<0?(D(n,{position:"absolute",top:"auto",left:0,bottom:0}),S(f)):c>0&&(D(n,{position:"absolute",top:0,left:0,bottom:"auto"}),S(0)))},S=function(e,n){var o=e/(f-s);o=Math.min(Math.max(o,0),1);var i=Math.floor(o*(t.count-1));(n||M!==i)&&(M=i,j(i))},j=function(e){i.clearRect(0,0,r,a);var n,o,f,s,u=g[e],c=m[u.imageIndex];t.cover&&!x?(n=b.offsetX,o=b.offsetY+h*u.y,f=b.width,s=b.height):(n=0,o=h*u.y,f=l,s=h),i.drawImage(c.img,n,o,f,s,0,0,r,a)},D=function(t,e){for(var n in e)t.style[n]=e[n]},G=function(){var e=10,n=2;return n+e*(1-t.speed)},J=function(t,e){var n=new Image;n.onload=function(){e(null,n)},n.onerror=function(){e("error loading image: "+t.src)},n.src=t.src},K=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}},P=function(t){console&&console.error&&console.error("::flipbook:: "+t)};y()};return t});