!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var o,e,n,i,r,a,f,s,u,c,d,l,h,p,m,g,w,v,b,x={},M=-1,y=function(){window.requestAnimatoinFrame=P();var t=F();t?Q("invalid options, missing "+t):(k(),A(),E(),H(function(t){t?Q(t):q()}))},F=function(){var o,e;return e=t.sprite?["id","filename","rows"]:["id","filename","count"],e.forEach(function(e){t[e]||(o=e)}),o},k=function(){t.speed=isNaN(t.speed)?.5:Math.min(Math.max(0,parseFloat(t.speed)),1),t.sprite?t.count=t.rows.reduce(function(t,o){return t+o}):t.count=parseInt(t.count),b=t.gif},q=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),w=!0,N(),I(),D(0),b&&B()},A=function(){o=document.getElementById(t.id),o.classList.add("flipbook-container"),e=document.createElement("div"),e.classList.add("flipbook-graphic"),o.appendChild(e),n=z(e),i=n.getContext("2d")},E=function(){G(o,{position:"relative",width:"100%",overflow:"hidden"}),G(e,{position:"absolute",top:0,left:0}),G(n,{position:"absolute",top:0,left:0})},I=function(){window.addEventListener("resize",N,!1),b||window.addEventListener("scroll",W,!1)},H=function(o){var e=t.sprite?t.rows.length:e=t.count;m=Y(e),g=[],L(0,e,o)},L=function(t,o,e){var n=m[t];K(n,function(i,r){if(i)e("error loading image");else{n.img=r,0===t&&R(r,n.rows);for(var a=0;a<n.rows;a++)g.push({imageIndex:t,x:0,y:a});C(t,o),t++,t<m.length?L(t,o,e):e()}})},R=function(t,o){l=t.naturalWidth,h=t.naturalHeight/o,p=Math.round(l/h*1e3)/1e3},C=function(o,e){t.progress&&"function"==typeof t.progress&&t.progress({frame:o+1,total:t.count,percent:Math.round(o/(e-1)*100)})},Y=function(o){for(var e=[],n=0;n<o;n++){var i=X(n+1);e[n]={src:i,rows:t.sprite?t.rows[n]:1}}return e},X=function(o){return t.filename(o)},z=function(t){var o=document.createElement("canvas");return o.classList.add("flipbook-canvas"),t.appendChild(o),o},B=function(){var t=g.length,o=0,e=function(){D(o),o++,o>=t&&(o=0),setTimeout(e,60)};e()},N=function(){if(r=o.offsetWidth,t.cover&&!b){a=innerHeight;var i=r/a;i<p?(x.width=Math.floor(i*h),x.height=h,x.offsetX=Math.floor((l-x.width)/2),x.offsetY=0):(x.height=Math.floor(l/i),x.width=l,x.offsetX=0,x.offsetY=Math.floor((h-x.height)/2))}else a=Math.floor(r/p);var u;u=b?20:innerHeight-a,s=a+u,n.width=r,n.height=a,n.style.top=Math.floor(u/2)+"px",e.style.height=s+"px",e.style.width=r+"px";var d=J();f=b?s:innerHeight*d,o.style.height=f+"px",T(),!b&&c&&(O(),j(pageYOffset-c,!0))},T=function(){var t=o.getBoundingClientRect();u=t.left,c=t.top,d=t.bottom-e.offsetHeight},W=function(){v||requestAnimationFrame(O),v=!0},O=function(){v=!1,w&&(T(),c<0&&d>0?(G(e,{position:"fixed",top:0,left:u+"px",bottom:"auto"}),j(Math.abs(c))):d<0?(G(e,{position:"absolute",top:"auto",left:0,bottom:0}),j(f)):c>0&&(G(e,{position:"absolute",top:0,left:0,bottom:"auto"}),j(0)))},j=function(o,e){var n=o/(f-s);n=Math.min(Math.max(n,0),1);var i=Math.floor(n*(t.count-1));(e||M!==i)&&(M=i,D(i))},D=function(o){i.clearRect(0,0,r,a);var e,n,f,s,u=g[o],c=m[u.imageIndex];t.cover&&!b?(e=x.offsetX,n=x.offsetY+h*u.y,f=x.width,s=x.height):(e=0,n=h*u.y,f=l,s=h),i.drawImage(c.img,e,n,f,s,0,0,r,a)},G=function(t,o){for(var e in o)t.style[e]=o[e]},J=function(){var o=10,e=2;return e+o*(1-t.speed)},K=function(t,o){var e=new Image;e.onload=function(){o(null,e)},e.onerror=function(){o("error loading image: "+t.src)},e.src=t.src},P=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}},Q=function(t){console&&console.error&&console.error("::flipbook:: "+t)};y()};return t});