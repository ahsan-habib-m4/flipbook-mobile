!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var e,o,n,i,r,a,f,s,u,c,d,l,h,p,m,g,w,v,x,b={},M=-1,y=function(){window.requestAnimatoinFrame=P();var t=F();t?Q("invalid options, missing "+t):(I(),q(),A(),H(function(t){t?Q(t):k()}))},F=function(){var e,o;return o=t.sprite?["id","path","extension","filename","rows"]:["id","path","extension","filename","count"],o.forEach(function(o){t[o]||(e=o)}),e},I=function(){t.speed=isNaN(t.speed)?.5:Math.min(Math.max(0,parseFloat(t.speed)),1),t.sprite?t.count=t.rows.reduce(function(t,e){return t+e}):t.count=parseInt(t.count),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/"),x=t.gif},k=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),w=!0,N(),E(),D(0),x&&B()},q=function(){e=document.getElementById(t.id),e.classList.add("flipbook-container"),o=document.createElement("div"),o.classList.add("flipbook-graphic"),e.appendChild(o),n=z(o),i=n.getContext("2d")},A=function(){G(e,{position:"relative",width:"100%",overflow:"hidden"}),G(o,{position:"absolute",top:0,left:0}),G(n,{position:"absolute",top:0,left:0})},E=function(){window.addEventListener("resize",N,!1),x||window.addEventListener("scroll",T,!1)},H=function(e){var o=t.sprite?t.rows.length:o=t.count;m=Y(o),g=[],L(0,o,e)},L=function(t,e,o){var n=m[t];K(n,function(i,r){if(i)o("error loading image");else{n.img=r,0===t&&R(r,n.rows);for(var a=0;a<n.rows;a++)g.push({imageIndex:t,x:0,y:a});C(t,e),t++,t<m.length?L(t,e,o):o()}})},R=function(t,e){l=t.naturalWidth,h=t.naturalHeight/e,p=Math.round(l/h*1e3)/1e3},C=function(e,o){t.progress&&"function"==typeof t.progress&&t.progress({frame:e+1,total:t.count,percent:Math.round(e/(o-1)*100)})},Y=function(e){for(var o=[],n=0;n<e;n++){var i=X(n+1);o[n]={src:i,rows:t.sprite?t.rows[n]:1}}return o},X=function(e){return t.filename(e)},z=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},B=function(){var t=g.length,e=0,o=function(){D(e),e++,e>=t&&(e=0),setTimeout(o,60)};o()},N=function(){if(r=e.offsetWidth,t.cover&&!x){a=innerHeight;var i=r/a;i<p?(b.width=Math.floor(i*h),b.height=h,b.offsetX=Math.floor((l-b.width)/2),b.offsetY=0):(b.height=Math.floor(l/i),b.width=l,b.offsetX=0,b.offsetY=Math.floor((h-b.height)/2))}else a=Math.floor(r/p);var u;u=x?20:innerHeight-a,s=a+u,n.width=r,n.height=a,n.style.top=Math.floor(u/2)+"px",o.style.height=s+"px",o.style.width=r+"px";var d=J();f=x?s:innerHeight*d,e.style.height=f+"px",O(),!x&&c&&(W(),j(pageYOffset-c,!0))},O=function(){var t=e.getBoundingClientRect();u=t.left,c=t.top,d=t.bottom-o.offsetHeight},T=function(){v||requestAnimationFrame(W),v=!0},W=function(){v=!1,w&&(O(),c<0&&d>0?(G(o,{position:"fixed",top:0,left:u+"px",bottom:"auto"}),j(Math.abs(c))):d<0?(G(o,{position:"absolute",top:"auto",left:0,bottom:0}),j(f)):c>0&&(G(o,{position:"absolute",top:0,left:0,bottom:"auto"}),j(0)))},j=function(e,o){var n=e/(f-s);n=Math.min(Math.max(n,0),1);var i=Math.floor(n*(t.count-1));(o||M!==i)&&(M=i,D(i))},D=function(e){i.clearRect(0,0,r,a);var o,n,f,s,u=g[e],c=m[u.imageIndex];t.cover&&!x?(o=b.offsetX,n=b.offsetY+h*u.y,f=b.width,s=b.height):(o=0,n=h*u.y,f=l,s=h),i.drawImage(c.img,o,n,f,s,0,0,r,a)},G=function(t,e){for(var o in e)t.style[o]=e[o]},J=function(){var e=10,o=2;return o+e*(1-t.speed)},K=function(t,e){var o=new Image;o.onload=function(){e(null,o)},o.onerror=function(){e("error loading image: "+t.src)},o.src=t.src},P=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}},Q=function(t){console&&console.error&&console.error("::flipbook:: "+t)};y()};return t});